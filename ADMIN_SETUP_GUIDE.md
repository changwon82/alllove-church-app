# 관리자 계정 생성 가이드

이 가이드는 처음 관리자 계정을 만드는 전체 과정을 안내합니다.

## 📋 전체 과정 요약

1. 회원가입
2. Supabase에서 사용자 정보 확인
3. SQL로 관리자 권한 부여
4. 관리자 페이지 접속 확인

---

## 1단계: 회원가입

### 1.1 메인 페이지에서 회원가입
1. 메인 페이지(`/`) 접속
2. "회원가입" 버튼 클릭 (팝업 모달 열림)
3. 다음 정보 입력:
   - **이름**: 관리자 이름 (예: "관리자")
   - **아이디**: 로그인에 사용할 아이디 (예: "admin")
   - **비밀번호**: 안전한 비밀번호 입력 (최소 6자)
   - **비밀번호 확인**: 동일한 비밀번호 재입력
   - **이메일**: 선택사항 (입력하지 않아도 됨)
4. "회원가입" 버튼 클릭
5. "회원가입이 완료되었습니다! 관리자 승인 후 로그인할 수 있습니다." 메시지 확인

### 1.2 회원가입 완료 확인
- 회원가입이 성공하면 계정이 생성됩니다.
- 이 시점에서는 아직 일반 사용자(`role: 'user'`)로 생성됩니다.

---

## 2단계: Supabase에서 사용자 정보 확인

### 2.1 Supabase 대시보드 접속
1. [Supabase 대시보드](https://app.supabase.com) 접속
2. 프로젝트 선택

### 2.2 사용자 정보 확인
1. 왼쪽 메뉴에서 **"Authentication"** → **"Users"** 클릭
2. 방금 가입한 계정 찾기:
   - 이메일 형식: `아이디@church.local` (예: `admin@church.local`)
   - 또는 가입 시간으로 확인
3. 사용자의 **UUID** 복사 (나중에 필요)

### 2.3 프로필 정보 확인
1. 왼쪽 메뉴에서 **"Table Editor"** 클릭
2. **"profiles"** 테이블 선택
3. 방금 가입한 사용자 찾기:
   - `user_id`가 위에서 복사한 UUID와 일치하는 행 찾기
   - 또는 `username`으로 검색
4. 현재 상태 확인:
   - `role`: `user` (일반 사용자)
   - `approved`: `false` (승인 대기)

---

## 3단계: SQL로 관리자 권한 부여

### 3.1 SQL Editor 열기
1. Supabase 대시보드에서 왼쪽 메뉴 **"SQL Editor"** 클릭
2. **"New query"** 클릭

### 3.2 관리자 권한 부여 SQL 실행

**방법 1: 아이디로 관리자 설정 (권장)**
```sql
-- 아이디가 'admin'인 사용자를 관리자로 설정
UPDATE profiles
SET 
  role = 'admin',
  approved = true
WHERE username = 'admin';
```

**방법 2: 이메일로 관리자 설정**
```sql
-- 이메일이 'admin@church.local'인 사용자를 관리자로 설정
UPDATE profiles
SET 
  role = 'admin',
  approved = true
WHERE email = 'admin@church.local';
```

**방법 3: user_id로 관리자 설정**
```sql
-- user_id를 직접 지정하여 관리자로 설정
-- (2단계에서 복사한 UUID 사용)
UPDATE profiles
SET 
  role = 'admin',
  approved = true
WHERE user_id = '여기에-UUID-입력';
```

### 3.3 실행 및 확인
1. SQL 쿼리 입력 후 **"Run"** 버튼 클릭
2. 성공 메시지 확인: `Success. No rows returned`
3. **"Table Editor"**에서 `profiles` 테이블 확인:
   - `role`: `admin` ✅
   - `approved`: `true` ✅

---

## 4단계: 관리자 페이지 접속 확인

### 4.1 로그인
1. 메인 페이지(`/`) 접속
2. "로그인 후 이용해 주세요" 버튼 클릭
3. 팝업 모달에서:
   - **아이디**: 회원가입 시 입력한 아이디 (예: "admin")
   - **비밀번호**: 회원가입 시 입력한 비밀번호
4. "로그인" 버튼 클릭
5. 로그인 성공 시 메인 페이지로 이동

### 4.2 관리자 페이지 접속
1. 왼쪽 사이드바 메뉴 확인
2. **"관리자페이지"** 메뉴 항목이 보이는지 확인 ✅
3. **"관리자페이지"** 클릭
4. 관리자 대시보드가 표시되면 성공! 🎉

---

## ✅ 확인 사항

관리자 계정이 제대로 설정되었는지 확인:

1. **로그인 가능**: 아이디와 비밀번호로 로그인 성공
2. **사이드바에 "관리자페이지" 표시**: 로그인 후 왼쪽 메뉴에 관리자 메뉴 보임
3. **관리자 페이지 접속 가능**: `/admin` 경로 접속 시 대시보드 표시
4. **사용자 관리 가능**: `/admin/users`에서 다른 사용자 관리 가능

---

## 🔧 문제 해결

### 문제 1: "접근 권한이 없습니다" 메시지
**원인**: `role`이 `admin`으로 설정되지 않음
**해결**: 3단계 SQL을 다시 실행하고 `role`이 `admin`인지 확인

### 문제 2: "관리자 승인 대기 중입니다" 메시지
**원인**: `approved`가 `false`로 설정됨
**해결**: 3단계 SQL에서 `approved = true`도 함께 설정

### 문제 3: 사이드바에 "관리자페이지"가 안 보임
**원인**: 프로필 정보가 제대로 로드되지 않음
**해결**: 
1. 로그아웃 후 다시 로그인
2. 브라우저 새로고침
3. Supabase에서 프로필 정보 재확인

### 문제 4: SQL 실행 시 에러 발생
**원인**: 잘못된 UUID 또는 존재하지 않는 사용자
**해결**:
1. 2단계에서 사용자 정보를 정확히 확인
2. `profiles` 테이블에서 해당 사용자가 존재하는지 확인
3. `username` 또는 `email`로 검색하여 정확한 값 사용

---

## 📝 빠른 참조 SQL

### 모든 관리자 확인
```sql
SELECT id, name, username, email, role, approved
FROM profiles
WHERE role = 'admin';
```

### 특정 사용자 정보 확인
```sql
SELECT id, name, username, email, role, approved, user_id
FROM profiles
WHERE username = 'admin';
```

### 관리자 권한 제거 (일반 사용자로 변경)
```sql
UPDATE profiles
SET 
  role = 'user',
  approved = false
WHERE username = 'admin';
```

---

## 🎯 다음 단계

관리자 계정이 생성되면:
1. **다른 사용자 승인**: `/admin/users`에서 대기 중인 사용자 승인
2. **사용자 관리**: 사용자 정보 수정, 권한 변경
3. **대시보드 확인**: `/admin/dashboard`에서 통계 확인

---

## 💡 팁

- **첫 관리자 계정**: 처음 관리자를 만들 때는 SQL로 직접 설정해야 합니다.
- **추가 관리자**: 첫 관리자가 생성되면 `/admin/users`에서 다른 사용자를 관리자로 승격시킬 수 있습니다.
- **보안**: 관리자 아이디와 비밀번호를 안전하게 보관하세요.
